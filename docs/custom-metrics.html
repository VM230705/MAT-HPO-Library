<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Metrics & Rewards - MAT-HPO Library</title>
    <meta name="description" content="Learn how to use custom metrics and reward functions in MAT-HPO for time series forecasting and other domains">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>"></head>
<body>
    <button class="mobile-toggle">‚ò∞</button>

    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">M</div>
                    <div class="logo-text">
                        <h1>MAT-HPO</h1>
                        <p>Multi-Agent HPO</p>
                    </div>
                </a>
                <div style="margin-top: 1rem;">
                    <span class="version-badge">v1.1.0</span>
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <div class="nav-section">Getting Started</div>
                </li>
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="installation.html" class="nav-link">Installation</a>
                </li>
                <li class="nav-item">
                    <a href="quickstart.html" class="nav-link">Quick Start</a>
                </li>
                <li class="nav-item">
                    <a href="easy-hpo.html" class="nav-link">EasyHPO Interface</a>
                </li>

                <li class="nav-item">
                    <div class="nav-section">Advanced Features</div>
                </li>
                <li class="nav-item">
                    <a href="custom-metrics.html" class="nav-link active">Custom Metrics & Rewards</a>
                </li>
                <li class="nav-item">
                    <a href="llm-strategies.html" class="nav-link">LLM Strategies</a>
                </li>

                <li class="nav-item">
                    <div class="nav-section">API Reference</div>
                </li>
                <li class="nav-item">
                    <a href="api/base-environment.html" class="nav-link">BaseEnvironment</a>
                </li>
                <li class="nav-item">
                    <a href="api/full-control-hpo.html" class="nav-link">FullControlHPO</a>
                </li>
                <li class="nav-item">
                    <a href="api/hyperparameter-space.html" class="nav-link">HyperparameterSpace</a>
                </li>
                <li class="nav-item">
                    <a href="api/optimizer.html" class="nav-link">MAT_HPO_Optimizer</a>
                </li>
                <li class="nav-item">
                    <a href="api/configs.html" class="nav-link">Configs</a>
                </li>

                <li class="nav-item">
                    <div class="nav-section">Examples</div>
                </li>
                <li class="nav-item">
                    <a href="examples/simple.html" class="nav-link">Simple Example</a>
                </li>
                <li class="nav-item">
                    <a href="examples/easy-hpo.html" class="nav-link">EasyHPO Examples</a>
                </li>

                <li class="nav-item">
                    <div class="nav-section">Resources</div>
                </li>
                <li class="nav-item">
                    <a href="https://github.com/VM230705/MAT-HPO-Library" class="nav-link external">GitHub</a>
                </li>
            </ul>
        </nav>

        <main class="content">
            <div class="content-header">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="separator">/</span>
                    <span>Custom Metrics & Rewards</span>
                </nav>
                <h1>Custom Metrics & Rewards</h1>
                <p class="subtitle">Flexible configuration for time series forecasting and beyond</p>
            </div>

            <div class="main-content">

                <section class="doc-section">
                    <h2 id="overview">üìä Custom Metrics</h2>
                    <p>MAT-HPO provides a <strong>flexible parameter-based interface</strong> that allows you to customize metrics tracking and reward computation <strong>without modifying the library code</strong>. This feature is especially useful for:</p>

                    <ul>
                        <li> <strong>Time Series Forecasting</strong>: Track MASE, SMAPE, MAE, RMSE instead of F1/AUC/G-mean</li>
                        <li> <strong>Regression Tasks</strong>: Use MSE, R¬≤, RMSE, MAE as metrics</li>
                        <li> <strong>Custom Domains</strong>: Define any metrics specific to your problem</li>
                        <li> <strong>Custom Rewards</strong>: Implement complex reward functions based on multiple objectives</li>
                    </ul>

                    <div class="info-box">
                        <h3>‚úÖ Key Benefits</h3>
                        <ul>
                            <li>No library code modification needed</li>
                            <li>Support for arbitrary number of metrics (not limited to 3)</li>
                            <li>Preserves original metric values for proper evaluation</li>
                            <li>Backward compatible with existing F1/AUC/G-mean interface</li>
                            <li>Domain-agnostic design</li>
                        </ul>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="three-components">Three Core Components</h2>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>1Ô∏è‚É£ BaseEnvironment Parameters</h3>
                            <p>Configure metrics and rewards in your environment:</p>
                            <ul>
                                <li><code>custom_metrics</code>: List of metrics to track</li>
                                <li><code>metric_names_mapping</code>: Display name mapping</li>
                                <li><code>reward_function</code>: Custom reward logic</li>
                            </ul>
                        </div>

                        <div class="feature-card">
                            <h3>2Ô∏è‚É£ HPOLogger Configuration</h3>
                            <p>Enhanced logging with custom metrics:</p>
                            <ul>
                                <li><code>metrics_extractor</code>: Extract metrics from hyperparams</li>
                                <li><code>metric_names</code>: Custom display names</li>
                                <li>Automatic separation of original vs. transformed values</li>
                            </ul>
                        </div>

                        <div class="feature-card">
                            <h3>3Ô∏è‚É£ Automatic Integration</h3>
                            <p>Everything works seamlessly:</p>
                            <ul>
                                <li>Optimizer auto-detects environment config</li>
                                <li>Logger inherits metric settings</li>
                                <li>Flexible storage in <code>best_hyperparams.json</code></li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="time-series-example">Complete Time Series Example</h2>

                    <h3>Step 1: Define Custom Functions</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># Define custom reward function</span>
<span class="token keyword">def</span> <span class="token function">timeseries_reward</span><span class="token punctuation">(</span>metrics<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token string">"""Reward based on training loss (avoid data leakage)"""</span>
    train_loss <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'train_loss'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> train_loss <span class="token operator">&lt;</span> <span class="token number">300.0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0.9</span>
    <span class="token keyword">elif</span> train_loss <span class="token operator">&lt;</span> <span class="token number">400.0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0.7</span>
    <span class="token keyword">return</span> <span class="token number">0.3</span>

<span class="token keyword">def</span> <span class="token function">extract_timeseries_metrics</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
    <span class="token string">"""Extract all time series metrics from hyperparams"""</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">'train_loss'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'train_loss'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
        <span class="token string">'val_loss'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'val_loss'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
        <span class="token string">'mase'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mase'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
        <span class="token string">'smape'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'original_smape'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
        <span class="token string">'mae'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'original_mae'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
        <span class="token string">'rmse'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>hyperparams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'original_rmse'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">))</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre>
                    </div>

                    <h3>Step 2: Configure Environment</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token keyword">from</span> MAT_HPO_LIB <span class="token keyword">import</span> <span class="token class-name">BaseEnvironment</span>

<span class="token keyword">class</span> <span class="token class-name">TimeSeriesEnvironment</span><span class="token punctuation">(</span><span class="token class-name">BaseEnvironment</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token punctuation">,</span> dataset_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__init__</span><span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">f"TS-{model_name}-{dataset_name}"</span><span class="token punctuation">,</span>
            <span class="token comment">#  Custom metrics list</span>
            custom_metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train_loss'</span><span class="token punctuation">,</span> <span class="token string">'val_loss'</span><span class="token punctuation">,</span> <span class="token string">'mase'</span><span class="token punctuation">,</span> <span class="token string">'smape'</span><span class="token punctuation">,</span> <span class="token string">'mae'</span><span class="token punctuation">,</span> <span class="token string">'rmse'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">#  Metric name mapping (for display)</span>
            metric_names_mapping<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">'f1'</span><span class="token punctuation">:</span> <span class="token string">'SMAPE'</span><span class="token punctuation">,</span>
                <span class="token string">'auc'</span><span class="token punctuation">:</span> <span class="token string">'MAE'</span><span class="token punctuation">,</span>
                <span class="token string">'gmean'</span><span class="token punctuation">:</span> <span class="token string">'RMSE'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">#  Custom reward function</span>
            reward_function<span class="token operator">=</span>timeseries_reward
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">train_evaluate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> hyperparams<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Train your model...</span>
        train_loss <span class="token operator">=</span> <span class="token number">331.72</span>
        val_loss <span class="token operator">=</span> <span class="token number">346.51</span>

        <span class="token comment"># Evaluate on test set...</span>
        mase <span class="token operator">=</span> <span class="token number">2.304</span>
        mae <span class="token operator">=</span> <span class="token number">632.53</span>
        rmse <span class="token operator">=</span> <span class="token number">809.25</span>
        smape <span class="token operator">=</span> <span class="token number">0.0618</span>

        <span class="token comment"># Return all metrics</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment"># Original training metrics</span>
            <span class="token string">'train_loss'</span><span class="token punctuation">:</span> train_loss<span class="token punctuation">,</span>
            <span class="token string">'val_loss'</span><span class="token punctuation">:</span> val_loss<span class="token punctuation">,</span>
            <span class="token string">'overfitting_ratio'</span><span class="token punctuation">:</span> val_loss <span class="token operator">/</span> train_loss<span class="token punctuation">,</span>

            <span class="token comment"># Original test metrics</span>
            <span class="token string">'mase'</span><span class="token punctuation">:</span> mase<span class="token punctuation">,</span>
            <span class="token string">'smape'</span><span class="token punctuation">:</span> smape<span class="token punctuation">,</span>
            <span class="token string">'mae'</span><span class="token punctuation">:</span> mae<span class="token punctuation">,</span>
            <span class="token string">'rmse'</span><span class="token punctuation">:</span> rmse<span class="token punctuation">,</span>

            <span class="token comment"># Transformed values for MAT-HPO (higher is better)</span>
            <span class="token string">'f1'</span><span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> smape <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'auc'</span><span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> mae <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'gmean'</span><span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> rmse <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

            <span class="token comment"># Save original values</span>
            <span class="token string">'original_smape'</span><span class="token punctuation">:</span> smape<span class="token punctuation">,</span>
            <span class="token string">'original_mae'</span><span class="token punctuation">:</span> mae<span class="token punctuation">,</span>
            <span class="token string">'original_rmse'</span><span class="token punctuation">:</span> rmse
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">compute_reward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> metrics<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Use custom reward function</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>custom_reward_function<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>custom_reward_function<span class="token punctuation">(</span>metrics<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0.5</span>
</code></pre>
                    </div>

                    <h3>Step 3: Create Logger and Optimizer</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token keyword">from</span> MAT_HPO_LIB <span class="token keyword">import</span> <span class="token class-name">MAT_HPO_Optimizer</span><span class="token punctuation">,</span> <span class="token class-name">HyperparameterSpace</span>
<span class="token keyword">from</span> MAT_HPO_LIB<span class="token punctuation">.</span>utils <span class="token keyword">import</span> <span class="token class-name">DefaultConfigs</span>
<span class="token keyword">from</span> MAT_HPO_LIB<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>logger <span class="token keyword">import</span> <span class="token class-name">HPOLogger</span>

<span class="token comment"># Create environment</span>
env <span class="token operator">=</span> <span class="token class-name">TimeSeriesEnvironment</span><span class="token punctuation">(</span><span class="token string">"dlinear"</span><span class="token punctuation">,</span> <span class="token string">"us_births"</span><span class="token punctuation">)</span>

<span class="token comment"># Create hyperparameter space</span>
space <span class="token operator">=</span> <span class="token class-name">HyperparameterSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
space<span class="token punctuation">.</span><span class="token function">add_continuous</span><span class="token punctuation">(</span><span class="token string">'learning_rate'</span><span class="token punctuation">,</span> <span class="token number">1e-5</span><span class="token punctuation">,</span> <span class="token number">1e-2</span><span class="token punctuation">,</span> agent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
space<span class="token punctuation">.</span><span class="token function">add_discrete</span><span class="token punctuation">(</span><span class="token string">'batch_size'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> agent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Create config</span>
config <span class="token operator">=</span> <span class="token class-name">DefaultConfigs</span><span class="token punctuation">.</span><span class="token function">standard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
config<span class="token punctuation">.</span>max_steps <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment"># Create optimizer (automatically inherits environment's custom metrics)</span>
optimizer <span class="token operator">=</span> <span class="token class-name">MAT_HPO_Optimizer</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> space<span class="token punctuation">,</span> config<span class="token punctuation">)</span>

<span class="token comment"># Run optimization</span>
results <span class="token operator">=</span> optimizer<span class="token punctuation">.</span><span class="token function">optimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token builtin">print</span><span class="token punctuation">(</span><span class="token string">f"Best reward: {results['best_performance']['reward']:.4f}"</span><span class="token punctuation">)</span>
</code></pre>
                    </div>

                    <div class="tip-box">
                        <h3> Pro Tip</h3>
                        <p>The optimizer automatically detects and uses the custom metrics configuration from your environment. No manual logger setup needed!</p>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="output-format">Output Format</h2>

                    <h3>best_hyperparams.json</h3>
                    <pre><code class="language-json"><span class="p">{</span>
  <span class="s2">&quot;hyperparameters&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">32</span>
  <span class="p">},</span>
  <span class="s2">&quot;performance&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;smape&quot;</span><span class="p">:</span> <span class="mf">0.0618</span><span class="p">,</span>
    <span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="mf">632.53</span><span class="p">,</span>
    <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="mf">809.25</span><span class="p">,</span>
    <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="mf">2.304</span><span class="p">,</span>
    <span class="s2">&quot;train_loss&quot;</span><span class="p">:</span> <span class="mf">331.72</span><span class="p">,</span>
    <span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="mf">346.51</span><span class="p">,</span>
    <span class="s2">&quot;overfitting_ratio&quot;</span><span class="p">:</span> <span class="mf">1.045</span><span class="p">,</span>
    <span class="s2">&quot;reward&quot;</span><span class="p">:</span> <span class="mf">0.7512</span>
  <span class="p">},</span>
  <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">}</span>
</code></pre>

                    <h3>step_log.jsonl (each line)</h3>
                    <pre><code class="language-json"><span class="p">{</span>
  <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-10-03T08:00:00&quot;</span><span class="p">,</span>
  <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;train_loss&quot;</span><span class="p">:</span> <span class="mf">331.72</span><span class="p">,</span>
    <span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="mf">346.51</span><span class="p">,</span>
    <span class="s2">&quot;overfitting_ratio&quot;</span><span class="p">:</span> <span class="mf">1.045</span><span class="p">,</span>
    <span class="s2">&quot;mase&quot;</span><span class="p">:</span> <span class="mf">2.304</span><span class="p">,</span>
    <span class="s2">&quot;smape&quot;</span><span class="p">:</span> <span class="mf">0.0618</span><span class="p">,</span>
    <span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="mf">632.53</span><span class="p">,</span>
    <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="mf">809.25</span><span class="p">,</span>
    <span class="s2">&quot;f1_transformed&quot;</span><span class="p">:</span> <span class="mf">0.7691</span><span class="p">,</span>
    <span class="s2">&quot;auc_transformed&quot;</span><span class="p">:</span> <span class="mf">0.1675</span><span class="p">,</span>
    <span class="s2">&quot;gmean_transformed&quot;</span><span class="p">:</span> <span class="mf">0.1000</span>
  <span class="p">},</span>
  <span class="s2">&quot;timing&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
  <span class="s2">&quot;hyperparameters&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</code></pre>

                    <div class="info-box">
                        <h3> Metric Separation</h3>
                        <p>The logger automatically separates:</p>
                        <ul>
                            <li><strong>Original values</strong>: <code>smape</code>, <code>mae</code>, <code>rmse</code> - True metric values for evaluation</li>
                            <li><strong>Transformed values</strong>: <code>*_transformed</code> - Used internally by MAT-HPO for optimization</li>
                        </ul>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="advanced-usage">Advanced Usage</h2>

                    <h3>Manual Logger Configuration</h3>
                    <p>For full control, you can manually configure the logger:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token keyword">from</span> MAT_HPO_LIB<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>logger <span class="token keyword">import</span> <span class="token class-name">HPOLogger</span>

<span class="token comment"># Create custom logger</span>
logger <span class="token operator">=</span> <span class="token class-name">HPOLogger</span><span class="token punctuation">(</span>
    output_dir<span class="token operator">=</span><span class="token string">'./results'</span><span class="token punctuation">,</span>
    metric_names<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'f1'</span><span class="token punctuation">:</span> <span class="token string">'SMAPE'</span><span class="token punctuation">,</span> <span class="token string">'auc'</span><span class="token punctuation">:</span> <span class="token string">'MAE'</span><span class="token punctuation">,</span> <span class="token string">'gmean'</span><span class="token punctuation">:</span> <span class="token string">'RMSE'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    custom_metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train_loss'</span><span class="token punctuation">,</span> <span class="token string">'val_loss'</span><span class="token punctuation">,</span> <span class="token string">'mase'</span><span class="token punctuation">,</span> <span class="token string">'smape'</span><span class="token punctuation">,</span> <span class="token string">'mae'</span><span class="token punctuation">,</span> <span class="token string">'rmse'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    metrics_extractor<span class="token operator">=</span>extract_timeseries_metrics
<span class="token punctuation">)</span>

<span class="token comment"># Create optimizer</span>
optimizer <span class="token operator">=</span> <span class="token class-name">MAT_HPO_Optimizer</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> space<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
optimizer<span class="token punctuation">.</span>logger <span class="token operator">=</span> logger  <span class="token comment"># Override default logger</span>

<span class="token comment"># Run optimization</span>
results <span class="token operator">=</span> optimizer<span class="token punctuation">.</span><span class="token function">optimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                    </div>

                    <h3>Flexible Metric Count</h3>
                    <p>Track as many metrics as you need:</p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__init__</span><span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"MyEnv"</span><span class="token punctuation">,</span>
    custom_metrics<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token string">'train_loss'</span><span class="token punctuation">,</span> <span class="token string">'val_loss'</span><span class="token punctuation">,</span> <span class="token string">'test_loss'</span><span class="token punctuation">,</span>
        <span class="token string">'mase'</span><span class="token punctuation">,</span> <span class="token string">'smape'</span><span class="token punctuation">,</span> <span class="token string">'mae'</span><span class="token punctuation">,</span> <span class="token string">'rmse'</span><span class="token punctuation">,</span> <span class="token string">'mape'</span><span class="token punctuation">,</span> <span class="token string">'mse'</span><span class="token punctuation">,</span>
        <span class="token string">'overfitting_ratio'</span><span class="token punctuation">,</span> <span class="token string">'training_time'</span><span class="token punctuation">,</span> <span class="token string">'inference_time'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment"># ... other parameters</span>
<span class="token punctuation">)</span>
</code></pre>

                    <h3>Complex Reward Functions</h3>
                    <pre><code class="language-python"><span class="token keyword">def</span> <span class="token function">sophisticated_reward</span><span class="token punctuation">(</span>metrics<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token string">"""Multi-objective reward combining accuracy and efficiency"""</span>
    <span class="token comment"># Accuracy component (70%)</span>
    mase <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mase'</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
    accuracy_reward <span class="token operator">=</span> <span class="token number">0.7</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token builtin">max</span><span class="token punctuation">(</span>mase<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">))</span>

    <span class="token comment"># Efficiency component (20%)</span>
    train_time <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'training_time'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    efficiency_reward <span class="token operator">=</span> <span class="token number">0.2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> <span class="token builtin">max</span><span class="token punctuation">(</span>train_time <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">))</span>

    <span class="token comment"># Stability component (10%)</span>
    overfitting <span class="token operator">=</span> metrics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'overfitting_ratio'</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span>
    stability_reward <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token keyword">if</span> overfitting <span class="token operator">&lt;=</span> <span class="token number">1.2</span> <span class="token keyword">else</span> <span class="token number">0.5</span><span class="token punctuation">)</span>

    total_reward <span class="token operator">=</span> accuracy_reward <span class="token operator">+</span> efficiency_reward <span class="token operator">+</span> stability_reward
    <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> total_reward<span class="token punctuation">))</span>
</code></pre>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="use-cases">Use Cases</h2>

                    <div class="use-case-grid">
                        <div class="use-case-card">
                            <h3> Time Series Forecasting</h3>
                            <ul>
                                <li>Metrics: MASE, SMAPE, MAE, RMSE</li>
                                <li>Reward: Based on validation loss</li>
                                <li>Track overfitting ratio</li>
                            </ul>
                        </div>

                        <div class="use-case-card">
                            <h3> Regression</h3>
                            <ul>
                                <li>Metrics: MSE, RMSE, MAE, R¬≤</li>
                                <li>Reward: Inverse of validation MSE</li>
                                <li>Track prediction intervals</li>
                            </ul>
                        </div>

                        <div class="use-case-card">
                            <h3> Classification (Default)</h3>
                            <ul>
                                <li>Metrics: F1, AUC, G-mean, Precision, Recall</li>
                                <li>Reward: Weighted combination</li>
                                <li>Track per-class metrics</li>
                            </ul>
                        </div>

                        <div class="use-case-card">
                            <h3> Multi-Objective</h3>
                            <ul>
                                <li>Metrics: Accuracy + Speed + Memory</li>
                                <li>Reward: Pareto optimization</li>
                                <li>Track resource usage</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section class="doc-section">
                    <h2 id="best-practices">Best Practices</h2>

                    <div class="warning-box">
                        <h3>‚ö†Ô∏è Important Considerations</h3>
                        <ol>
                            <li><strong>Avoid Data Leakage</strong>: Use training/validation metrics for rewards, not test metrics</li>
                            <li><strong>Normalize Rewards</strong>: Keep rewards in a reasonable range (e.g., 0.0-1.0)</li>
                            <li><strong>Save Original Values</strong>: Always preserve original metrics with <code>original_*</code> prefix</li>
                            <li><strong>Transform Consistently</strong>: Ensure "higher is better" for f1/auc/gmean used in optimization</li>
                        </ol>
                    </div>

                    <h3>‚úÖ Recommended Patterns</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">python</span>
                            <button class="copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-python"><span class="token comment"># ‚úÖ Good: Save both original and transformed</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token string">'mase'</span><span class="token punctuation">:</span> <span class="token number">2.304</span><span class="token punctuation">,</span>                    <span class="token comment"># Original value</span>
    <span class="token string">'f1'</span><span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> mase <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># Transformed (higher is better)</span>
    <span class="token string">'original_mase'</span><span class="token punctuation">:</span> <span class="token number">2.304</span>            <span class="token comment"># Explicit original backup</span>
<span class="token punctuation">}</span>

<span class="token comment"># ‚ùå Bad: Only transformed values</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token string">'f1'</span><span class="token punctuation">:</span> <span class="token number">0.8</span> <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> mase <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token comment"># Lost original information!</span>
<span class="token punctuation">}</span>
</code></pre>
                </section>

                <section class="doc-section">
                    <h2 id="api-reference">API Reference</h2>

                    <h3>BaseEnvironment Parameters</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>custom_metrics</code></td>
                                <td><code>List[str]</code></td>
                                <td>List of custom metric names to track (e.g., ['mase', 'smape', 'mae'])</td>
                            </tr>
                            <tr>
                                <td><code>metric_names_mapping</code></td>
                                <td><code>Dict[str, str]</code></td>
                                <td>Map internal names to display names (e.g., {'f1': 'SMAPE', 'auc': 'MAE'})</td>
                            </tr>
                            <tr>
                                <td><code>reward_function</code></td>
                                <td><code>Callable[[Dict], float]</code></td>
                                <td>Custom reward computation function taking metrics dict, returning float</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>HPOLogger Parameters</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>metrics_extractor</code></td>
                                <td><code>Callable[[Dict], Dict]</code></td>
                                <td>Function to extract metrics from hyperparams dictionary</td>
                            </tr>
                            <tr>
                                <td><code>metric_names</code></td>
                                <td><code>Dict[str, str]</code></td>
                                <td>Custom metric display names for console output</td>
                            </tr>
                            <tr>
                                <td><code>custom_metrics</code></td>
                                <td><code>List[str]</code></td>
                                <td>List of metrics to track in logs</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <section class="doc-section">
                    <h2 id="examples">More Examples</h2>

                    <p>For complete runnable examples, see:</p>
                    <ul>
                        <li> <a href="https://github.com/VM230705/MAT-HPO-Library/blob/main/CUSTOM_METRICS_GUIDE.md">CUSTOM_METRICS_GUIDE.md</a> - Detailed Chinese guide</li>
                        <li> <a href="https://github.com/VM230705/MAT-HPO-Library/blob/main/examples/timeseries_custom_metrics_example.py">examples/timeseries_custom_metrics_example.py</a> - Full working example</li>
                    </ul>
                </section>

            </div>
        </main>
    </div>

    <script src="js/main.js"></script></body>
</html>
